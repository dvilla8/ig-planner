import{aI as L,q as T,aL as E,aM as _}from"./CDxOiNp2.js";import{a as A,j as U,d as D,Q as O,V as C,Z as b,l as h,a5 as S}from"./CBwktElb.js";import{a as x,V as I}from"./CpoP8e1F.js";import{V as R}from"./CD9oybvu.js";import{V as j}from"./BPBqaE1_.js";const k=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})();k?Promise.resolve().then(function(){return B}):Promise.resolve().then(function(){return Z});const M=k?Promise.resolve().then(function(){return H}):Promise.resolve().then(function(){return G});async function V(...e){return(await M).default(...e)}k?Promise.resolve().then(function(){return J}):Promise.resolve().then(function(){return X});const N=async e=>{const r=await e.getFile();return r.handle=e,r};var W=async(e=[{}])=>{Array.isArray(e)||(e=[e]);const r=[];e.forEach((l,a)=>{r[a]={description:l.description||"Files",accept:{}},l.mimeTypes?l.mimeTypes.map(o=>{r[a].accept[o]=l.extensions||[]}):r[a].accept["*/*"]=l.extensions||[]});const n=await window.showOpenFilePicker({id:e[0].id,startIn:e[0].startIn,types:r,multiple:e[0].multiple||!1,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1}),t=await Promise.all(n.map(N));return e[0].multiple?t:t[0]},B={__proto__:null,default:W};function g(e){function r(n){if(Object(n)!==n)return Promise.reject(new TypeError(n+" is not an object."));var t=n.done;return Promise.resolve(n.value).then(function(l){return{value:l,done:t}})}return g=function(n){this.s=n,this.n=n.next},g.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(n){var t=this.s.return;return t===void 0?Promise.resolve({value:n,done:!0}):r(t.apply(this.s,arguments))},throw:function(n){var t=this.s.return;return t===void 0?Promise.reject(n):r(t.apply(this.s,arguments))}},new g(e)}const F=async(e,r,n=e.name,t)=>{const l=[],a=[];var o,p=!1,s=!1;try{for(var c,m=function(i){var f,d,y,v=2;for(typeof Symbol<"u"&&(d=Symbol.asyncIterator,y=Symbol.iterator);v--;){if(d&&(f=i[d])!=null)return f.call(i);if(y&&(f=i[y])!=null)return new g(f.call(i));d="@@asyncIterator",y="@@iterator"}throw new TypeError("Object is not async iterable")}(e.values());p=!(c=await m.next()).done;p=!1){const i=c.value,f=`${n}/${i.name}`;i.kind==="file"?a.push(i.getFile().then(d=>(d.directoryHandle=e,d.handle=i,Object.defineProperty(d,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>f})))):i.kind!=="directory"||!r||t&&t(i)||l.push(F(i,r,f,t))}}catch(i){s=!0,o=i}finally{try{p&&m.return!=null&&await m.return()}finally{if(s)throw o}}return[...(await Promise.all(l)).flat(),...await Promise.all(a)]};var $=async(e={})=>{e.recursive=e.recursive||!1,e.mode=e.mode||"read";const r=await window.showDirectoryPicker({id:e.id,startIn:e.startIn,mode:e.mode});return(await(await r.values()).next()).done?[r]:F(r,e.recursive,void 0,e.skipDirectory)},H={__proto__:null,default:$},q=async(e,r=[{}],n=null,t=!1,l=null)=>{Array.isArray(r)||(r=[r]),r[0].fileName=r[0].fileName||"Untitled";const a=[];let o=null;if(e instanceof Blob&&e.type?o=e.type:e.headers&&e.headers.get("content-type")&&(o=e.headers.get("content-type")),r.forEach((c,m)=>{a[m]={description:c.description||"Files",accept:{}},c.mimeTypes?(m===0&&o&&c.mimeTypes.push(o),c.mimeTypes.map(i=>{a[m].accept[i]=c.extensions||[]})):o?a[m].accept[o]=c.extensions||[]:a[m].accept["*/*"]=c.extensions||[]}),n)try{await n.getFile()}catch(c){if(n=null,t)throw c}const p=n||await window.showSaveFilePicker({suggestedName:r[0].fileName,id:r[0].id,startIn:r[0].startIn,types:a,excludeAcceptAllOption:r[0].excludeAcceptAllOption||!1});!n&&l&&l(p);const s=await p.createWritable();return"stream"in e?(await e.stream().pipeTo(s),p):"body"in e?(await e.body.pipeTo(s),p):(await s.write(await e),await s.close(),p)},J={__proto__:null,default:q},Q=async(e=[{}])=>(Array.isArray(e)||(e=[e]),new Promise((r,n)=>{const t=document.createElement("input");t.type="file";const l=[...e.map(s=>s.mimeTypes||[]),...e.map(s=>s.extensions||[])].join();t.multiple=e[0].multiple||!1,t.accept=l||"",t.style.display="none",document.body.append(t);const a=s=>{typeof o=="function"&&o(),r(s)},o=e[0].legacySetup&&e[0].legacySetup(a,()=>o(n),t),p=()=>{window.removeEventListener("focus",p),t.remove()};t.addEventListener("click",()=>{window.addEventListener("focus",p)}),t.addEventListener("change",()=>{window.removeEventListener("focus",p),t.remove(),a(t.multiple?Array.from(t.files):t.files[0])}),"showPicker"in HTMLInputElement.prototype?t.showPicker():t.click()})),Z={__proto__:null,default:Q},z=async(e=[{}])=>(Array.isArray(e)||(e=[e]),e[0].recursive=e[0].recursive||!1,new Promise((r,n)=>{const t=document.createElement("input");t.type="file",t.webkitdirectory=!0;const l=o=>{typeof a=="function"&&a(),r(o)},a=e[0].legacySetup&&e[0].legacySetup(l,()=>a(n),t);t.addEventListener("change",()=>{let o=Array.from(t.files);e[0].recursive?e[0].recursive&&e[0].skipDirectory&&(o=o.filter(p=>p.webkitRelativePath.split("/").every(s=>!e[0].skipDirectory({name:s,kind:"directory"})))):o=o.filter(p=>p.webkitRelativePath.split("/").length===2),l(o)}),"showPicker"in HTMLInputElement.prototype?t.showPicker():t.click()})),G={__proto__:null,default:z},K=async(e,r={})=>{Array.isArray(r)&&(r=r[0]);const n=document.createElement("a");let t=e;"body"in e&&(t=await async function(o,p){const s=o.getReader(),c=new ReadableStream({start:f=>async function d(){return s.read().then(({done:y,value:v})=>{if(!y)return f.enqueue(v),d();f.close()})}()}),m=new Response(c),i=await m.blob();return s.releaseLock(),new Blob([i],{type:p})}(e.body,e.headers.get("content-type"))),n.download=r.fileName||"Untitled",n.href=URL.createObjectURL(await t);const l=()=>{typeof a=="function"&&a()},a=r.legacySetup&&r.legacySetup(l,()=>a(),n);return n.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(n.href),3e4),l()}),n.click(),null},X={__proto__:null,default:K};async function Y(){return V({recursive:!0,mode:"readwrite",startIn:"documents",id:"import-profile",skipDirectory:r=>r.name[0]==="."})}async function ee(e){return new Promise((r,n)=>{let t=new FileReader;t.readAsText(e),t.onload=function(){typeof t.result!="string"?n("Directory does not contain a valid config.json"):r(JSON.parse(t.result))},t.onerror=n})}const te=L("user/import",()=>{const e=T(),r=E(),n=A(null),t=A({});async function l(c){n.value=await Y(),t.value=await ee(a.value),t.value.profile.avatar=p(),t.value.media.posts&&o("posts"),t.value.media.reels&&o("reels"),t.value.origin="storage";const m=await e.loadUser(t.value);r.addUserToStorageIndex({username:m.raw.profile.username,platform:c})}const a=U(()=>n.value.find(c=>c.name==="config.json"));function o(c){var d,y,v,P;let m=0,i={},f={};for(const u of t.value.media[c]){if(i={},typeof u=="string")i.type=_.detectMediaType(u),u.startsWith("http")||(i.file=s(u));else if(u.type)switch(u.type){case"image":i.type=u.type,u.name&&!((d=u.name)!=null&&d.startsWith("http"))&&(i.file=s(u.name));break;case"video":i.type=u.type,u.name&&!((y=u.name)!=null&&y.startsWith("http"))&&(i.file=s(u.name)),u.cover&&typeof u.cover=="string"&&!((v=u.cover)!=null&&v.startsWith("http"))&&(i.file=s(u.cover));break;case"album":if(i.type=u.type,i.list=[],Array.isArray(u.list)){for(const w of u.list)f={},typeof w=="string"?(f.type=_.detectMediaType(w),f.file=s(w)):w.name&&(f.type=w.type,f.file=s(w.name));i.list.push(f)}break;case"iframe":u.cover&&typeof u.cover=="string"&&!((P=u.cover)!=null&&P.startsWith("http"))&&(i.cover=s(u.cover));break}t.value.media.posts[m]=i,m++}}function p(){return n.value.find(c=>c.name===t.value.profile.avatar)}function s(c){return n.value.find(m=>m.name===c)}return{importFromDirectory:l}}),se=D({__name:"UserSelectorAddMenuOptions",emits:["openCreateProfileDialog"],setup(e,{emit:r}){const n=te(),t=r;function l(){n.importFromDirectory("instagram")}return(a,o)=>(O(),C(j,{border:"",elevation:0},{default:b(()=>[h(x,{onClick:o[0]||(o[0]=p=>t("openCreateProfileDialog"))},{default:b(()=>[h(I,{textContent:S(a.$t("common.actions.createProfile"))},null,8,["textContent"])]),_:1}),h(R),h(x,{onClick:l},{default:b(()=>[h(I,{textContent:S(a.$t("common.actions.importProfile"))},null,8,["textContent"])]),_:1})]),_:1}))}});export{se as _};
